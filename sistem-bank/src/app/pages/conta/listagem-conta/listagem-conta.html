<!-- Navbar -->
<app-navbar></app-navbar>

<!-- Wrapper de conteúdo -->
<div class="content-wrapper">
  <div class="container-fluid py-4">
    <!-- Header responsivo -->
    <div class="row align-items-center mb-4">
      <div class="col-12 col-md-6 mb-3 mb-md-0">
        <h1 class="page-title mb-0">Listagem de Contas</h1>
        <p class="text-muted mt-1 d-none d-md-block">
          Gerencie todas as contas cadastradas no sistema
        </p>
      </div>
      <div class="col-12 col-md-6 text-md-end">
        <div class="d-flex gap-2 justify-content-md-end">
          <button
            mat-raised-button
            color="primary"
            routerLink="/conta/cadastro"
            class="btn-nova-conta"
          >
            <mat-icon class="me-2">add</mat-icon>
            Nova Conta
          </button>
          <button
            mat-raised-button
            color="accent"
            routerLink="/conta/deposito"
            class="btn-deposito"
          >
            <mat-icon class="me-2">savings</mat-icon>
            Depósito
          </button>
          <button
            mat-raised-button
            color="warn"
            routerLink="/conta/saque"
            class="btn-saque ms-2"
          >
            <mat-icon class="me-2">payments</mat-icon>
            <span class="d-inline d-sm-none">Saque</span>
            <span class="d-none d-sm-inline">Saque</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Loading state -->
    <div *ngIf="loading()" class="text-center py-5">
      <mat-spinner diameter="40"></mat-spinner>
      <p class="mt-3 text-muted">Carregando contas...</p>
    </div>

    <!-- Tabela Desktop -->
    <div class="d-none d-lg-block" *ngIf="!loading()">
      <div class="table-container">
        <table mat-table [dataSource]="dadosPaginados" class="w-100">
          <!-- Coluna ID -->
          <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef>ID</th>
            <td mat-cell *matCellDef="let element">
              <span class="id-badge">#{{element.id}}</span>
            </td>
          </ng-container>

          <!-- Coluna Número -->
          <ng-container matColumnDef="numero">
            <th mat-header-cell *matHeaderCellDef>Número</th>
            <td mat-cell *matCellDef="let element">
              <div class="numero-cell">
                <span class="numero-principal">{{element.numero}}</span>
              </div>
            </td>
          </ng-container>

          <!-- Coluna Agência -->
          <ng-container matColumnDef="agencia">
            <th mat-header-cell *matHeaderCellDef>Agência</th>
            <td mat-cell *matCellDef="let element">{{element.agencia}}</td>
          </ng-container>

          <!-- Coluna Cliente -->
          <ng-container matColumnDef="cliente">
            <th mat-header-cell *matHeaderCellDef>Cliente</th>
            <td mat-cell *matCellDef="let element">
              <div class="cliente-info">
                <span class="cliente-nome">{{element.clienteInfo.nome}}</span>
                <small class="cliente-cpf text-muted d-block"
                  >{{element.clienteInfo.cpf}}</small
                >
              </div>
            </td>
          </ng-container>

          <!-- Coluna Saldo -->
          <ng-container matColumnDef="saldo">
            <th mat-header-cell *matHeaderCellDef>Saldo</th>
            <td mat-cell *matCellDef="let element">
              <span
                class="saldo-valor"
                [class.positivo]="isSaldoPositivo(element.saldo)"
                [class.negativo]="!isSaldoPositivo(element.saldo)"
              >
                {{formatarSaldo(element.saldo)}}
              </span>
            </td>
          </ng-container>

          <!-- Coluna Funções -->
          <ng-container matColumnDef="funcoes">
            <th mat-header-cell *matHeaderCellDef>Ações</th>
            <td mat-cell *matCellDef="let element">
              <div class="action-buttons">
                <button
                  mat-icon-button
                  [routerLink]="'/conta/editar/' + element.id"
                  matTooltip="Editar conta"
                  class="action-btn edit-btn"
                >
                  <mat-icon>edit</mat-icon>
                </button>
                <button
                  mat-icon-button
                  (click)="deletarConta(element.id)"
                  matTooltip="Excluir conta"
                  class="action-btn delete-btn"
                >
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
      </div>
    </div>

    <!-- Cards Mobile/Tablet -->
    <div class="d-lg-none" *ngIf="!loading()">
      <div class="row">
        <div
          class="col-12 col-md-6 mb-3"
          *ngFor="let conta of dadosPaginados; trackBy: trackById"
        >
          <div class="card conta-card h-100">
            <div class="card-body">
              <!-- Header do card -->
              <div
                class="d-flex justify-content-between align-items-start mb-3"
              >
                <div>
                  <h6 class="card-title mb-1">Conta {{conta.numero}}</h6>
                  <small class="text-muted">#{{conta.id}}</small>
                </div>
                <span
                  class="saldo-badge"
                  [class.positivo]="isSaldoPositivo(conta.saldo)"
                  [class.negativo]="!isSaldoPositivo(conta.saldo)"
                >
                  {{formatarSaldo(conta.saldo)}}
                </span>
              </div>

              <!-- Informações da conta -->
              <div class="conta-info mb-3">
                <div class="info-item">
                  <mat-icon class="info-icon">business</mat-icon>
                  <span class="info-text">Agência: {{conta.agencia}}</span>
                </div>
                <div class="info-item">
                  <mat-icon class="info-icon">person</mat-icon>
                  <span class="info-text">{{conta.clienteInfo.nome}}</span>
                </div>
                <div class="info-item">
                  <mat-icon class="info-icon">badge</mat-icon>
                  <span class="info-text">{{conta.clienteInfo.cpf}}</span>
                </div>
              </div>

              <!-- Ações -->
              <div class="d-flex gap-2">
                <button
                  mat-stroked-button
                  color="primary"
                  [routerLink]="'/conta/editar/' + conta.id"
                  class="flex-fill"
                >
                  <mat-icon class="me-1">edit</mat-icon>
                  Editar
                </button>
                <button
                  mat-stroked-button
                  color="warn"
                  (click)="deletarConta(conta.id)"
                  class="flex-fill"
                >
                  <mat-icon class="me-1">delete</mat-icon>
                  Excluir
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty state -->
    <div
      *ngIf="!loading() && totalContas === 0"
      class="empty-state text-center py-5"
    >
      <mat-icon class="empty-icon mb-3">account_balance</mat-icon>
      <h4>Nenhuma conta encontrada</h4>
      <p class="text-muted mb-4">Comece cadastrando sua primeira conta</p>
      <button mat-raised-button color="primary" routerLink="/conta/novo">
        <mat-icon class="me-2">add</mat-icon>
        Cadastrar Primeira Conta
      </button>
    </div>

    <!-- Paginação -->
    <div
      class="d-flex justify-content-center mt-4"
      *ngIf="!loading() && totalContas > 0"
    >
      <mat-paginator
        [pageSizeOptions]="[5, 10, 20]"
        [showFirstLastButtons]="true"
        [length]="totalContas"
        [pageIndex]="pageIndex"
        [pageSize]="pageSize"
        (page)="onPageChange($event)"
        class="responsive-paginator"
      >
      </mat-paginator>
    </div>
  </div>
</div>
